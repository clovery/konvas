{"version":3,"file":"konvas.js","sources":["../src/dragger/index.ts","../src/dragger/isOut.ts","../src/node.ts","../src/index.ts","../src/utils/dom.ts"],"sourcesContent":["import Canvas from '../index'\nimport isOut from './isOut'\n\n/**\n * Dragger\n */\nclass Dragger {\n  private canvas: Canvas\n  private opts: { onStart: any, onStop: any, onMove: any }\n  private active: any\n  private dragging: any\n  private mouse: any\n  private startPoint: any\n  private x: number | null\n  private y: number | null\n\n  constructor(canvas: Canvas, opts: any) {\n    this.canvas = canvas\n    this.opts = opts\n    this.x = 0\n    this.y = 0\n    this.initEvent()\n  }\n\n  private initEvent() {\n    this.canvas.el.addEventListener('mousedown', this.onMouseDown, false)\n    this.canvas.el.addEventListener('mouseup', this.onMouseUp, false)\n    // this.canvas.elem.addEventListener('mouseleave', this.onMouseUp, false)\n\n    document.documentElement.addEventListener('mousemove', this.onMouseMove, false)\n    document.documentElement.addEventListener('mouseup', this.onMouseUp, false)\n  }\n\n  private onMouseDown = (e: Event) => {\n    const { target } = e\n    const targetElem = target as HTMLElement\n\n    if (targetElem.classList.contains('draggable')) {\n      this.active = this.canvas.getNode(targetElem.id)\n\n      this.dragging = true\n\n      if (this.mouse && this.active) {\n        this.startPoint = {\n          x: this.mouse.x - this.active.x,\n          y: this.mouse.y - this.active.y\n        }\n      }\n      this.opts.onStart(targetElem.id)\n    }\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    let x = e.pageX - this.canvas.left\n    let y = e.pageY - this.canvas.top\n\n    x = x / this.canvas.scale\n    y = y / this.canvas.scale\n\n    this.mouse = { x, y }\n\n    if (this.dragging && this.active) {\n      x = x - this.startPoint.x\n      const xStr = String(Math.round(x))\n      const yStr = String(Math.round(y - this.startPoint.y))\n      x = parseInt(xStr, 10)\n      y = parseInt(yStr, 10)\n\n      const isout = isOut(x, y, this.canvas, this.active)\n      if (isout.x >= 0 || isout.y >= 0) {\n        x = isout.x\n        y = isout.y\n      }\n      this.opts.onMove(this.active.id, { x, y })\n      this.x = x\n      this.y = y\n    }\n  }\n\n  private onMouseUp = () => {\n    if (this.dragging && this.active) {\n\n      this.dragging = false\n\n      const { id } = this.active\n\n      if (id) {\n        if (typeof this.x !== 'undefined'\n          && typeof this.y !== 'undefined') {\n          this.opts.onStop(id, { x: this.x, y: this.y })\n        }\n\n        this.x = null\n        this.y = null\n        this.active = null\n      }\n    }\n  }\n}\n\nexport default Dragger\n","export default function isOut(x: number, y: number, container: any, node: any): { x: number, y: number } {\n  let newX = x \n  let newY = y\n  if (x <= 0) {\n    newX = 0\n  }\n\n  if (y <= 0) {\n    newY = 0\n  }\n\n  if (x + node.width >= container.width) {\n    newX = container.width - node.width\n  }\n\n  if (y + node.height >= container.height) {\n    newY = container.height - node.height\n  }\n\n  return {\n    x: newX >= 0 ? newX : -1,\n    y: newY >= 0 ? newY : -1\n  }\n}\n","let uid: number = 1\n\n/**\n *\n */\nclass Node {\n  private el: Element\n  private data: any\n  public id: string\n  public x: number\n  public y: number\n  public layout: {\n    rotate: number\n  } \n\n  constructor(data: any) {\n    this.el = document.createElement('div')\n\n    this.id = String(uid++)\n    this.el.id = this.id\n\n    this.el.classList.add('node')\n    this.el.classList.add('draggable')\n\n    this.data = { ...data }\n\n    this.x = this.data.x || 0\n    this.y = this.data.y || 0\n\n    this.layout = {\n      rotate: 0\n    }\n    this.initStyle()\n    this.draw()\n  }\n\n  private initStyle() {\n    const el = this.el as HTMLElement\n    el.style.position = 'absolute'\n  }\n\n  /*\n  get x(): number {\n    return 0\n  }\n\n  get y(): number {\n    return 0\n  }\n  */\n\n  get width() {\n    return this.data.width\n  }\n\n  set width(val) {\n    this.data.width = val\n  }\n\n  get height() {\n    return this.data.height\n  }\n\n  set height(val: number) {\n    this.data.height = val\n  }\n\n  set rotate(deg: number) {\n    this.layout.rotate = deg\n    const el = this.el as HTMLElement\n    el.style.transform = `rotate(${deg}deg)`\n  }\n\n  get rotate() {\n    return this.layout.rotate\n  }\n\n  get scale() {\n    return this.data.scale || 1\n  }\n\n  set scale(val) {\n    this.data.scale = val\n    this.draw()\n  }\n\n  public move(x: number, y: number) {\n    this.x = x\n    this.y = y\n    const el = this.el as HTMLElement\n    el.style.left = `${x}px`\n    el.style.top = `${y}px`\n  }\n\n  public draw() {\n    const el = this.el as HTMLElement\n\n    el.style.width = `${ this.width * this.scale }px`\n    el.style.height = `${ this.height * this.scale }px`\n  }\n\n  public toJSON() {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      scale: this.scale\n    }\n  }\n}\n\nexport default Node\n","import { query } from './utils/dom'\nimport Dragger from './dragger'\nimport Node from './node'\n\n/*\ninterface IOptions {\n  width?: number;\n  height?: number;\n}\n*/\n\nclass Konvas {\n  public el: Element\n  private options: any\n  private dragger: Dragger\n  public nodes: Node[]\n  public activeNode: Node\n  public layout: {\n    width: number,\n    height: number,\n    scale: number\n  } \n\n  constructor(el: Element | string, options = { width: 600, height: 300, scale: 1 } ) {\n    this.el = query(el)\n    this.options = options\n    this.nodes = []\n\n    this.layout = {\n      width: options.width,\n      height: options.height,\n      scale: options.scale || 1\n    }\n\n    /*\n    Object.defineProperty(this, 'scale', {\n      set(val: number) {\n        this.layout.scale = val\n      },\n      get(): any {\n        return this.layout.scale\n      }\n    }) */\n\n    this.dragger = new Dragger(this, {\n      onStart: (id: string) => {\n        const node = this.getNode(id)\n        if (node) {\n          this.activeNode = node\n        }\n        // this.resizeable.hide()\n      },\n      onMove: (id: string, { x, y }) => {\n        this.activeNode.move(x, y)\n      },\n      onStop: (id: string) => {\n        // console.log(id)\n        // this.emit('drag.end', id, { x, y })\n        // this.resizeable.move(x, y)\n      }\n    })\n    this.initStyle()\n  }\n\n  private initStyle() {\n    this.el.classList.add('konvas')\n    const elem = (this.el as HTMLElement)\n    elem.style.position = 'relative'\n    elem.style.transformOrigin = '0 0'\n\n    this.render()\n  }\n\n  public render() {\n    const elem = (this.el as HTMLElement)\n    const width = this.width * this.scale\n    const height = this.height * this.scale\n\n    elem.setAttribute('data-scale', String(this.scale))\n    elem.style.width = `${width}px`\n    elem.style.height = `${height}px`\n  }\n\n  public addNode(node: Node | any) {\n    if (node instanceof Node) {\n      this.nodes.push(node)\n    } else {\n      node = new Node(node)\n      this.el.appendChild(node.el)\n      this.nodes.push(node)\n    }\n  }\n\n  public getNode(node: Node | string): Node | null {\n    if (typeof node === 'string') {\n      const filters = this.nodes.filter((item: any) => item.id === node)\n      return filters[0]\n    }\n    return node\n  }\n\n  get left() {\n    return this.el.getBoundingClientRect().left\n  }\n\n  get top() {\n    return this.el.getBoundingClientRect().top\n  }\n\n  get scale() {\n    return this.layout.scale\n  }\n\n  set scale(val: number) {\n    this.layout.scale = val\n    this.render()\n  }\n\n  get width(): number {\n    return this.layout.width\n  }\n\n  get height(): number {\n    return this.layout.height\n  }\n\n  public toJSON() {\n    const nodes = this.nodes.map(node => {\n      return node.toJSON()\n    })\n\n    return {\n      width: this.width,\n      height: this.height,\n      scale: this.scale,\n      nodes\n    }\n  }\n}\n\nexport default Konvas\n","export function query(el: string | Element): Element {\n  if (typeof el === 'string') {\n    const node = document.querySelector(el)\n    if (!node) {\n      return document.createElement('div')\n    }\n    return node \n  } else {\n    return el\n  }\n}\n"],"names":["canvas","opts","this","e","targetElem","classList","contains","_this","active","getNode","id","dragging","mouse","startPoint","x","y","onStart","pageX","left","pageY","top","scale","xStr","String","Math","round","yStr","isout","container","node","newX","newY","width","height","isOut","parseInt","onMove","onStop","initEvent","Dragger","el","addEventListener","onMouseDown","onMouseUp","document","documentElement","onMouseMove","uid","data","createElement","add","layout","rotate","initStyle","draw","Node","style","position","Object","val","deg","transform","options","querySelector","query","nodes","dragger","activeNode","_a","move","Konvas","elem","transformOrigin","render","setAttribute","push","appendChild","filter","item","getBoundingClientRect","map","toJSON"],"mappings":"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"}