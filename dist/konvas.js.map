{"version":3,"file":"konvas.js","sources":["../src/dragger/index.ts","../src/dragger/isOut.ts","../src/node.ts","../src/utils/index.ts","../src/index.ts","../src/utils/dom.ts"],"sourcesContent":["import Canvas from '../index'\nimport isOut from './isOut'\n\n/**\n * Dragger\n */\nclass Dragger {\n  private canvas: Canvas\n  private opts: { onStart: any, onStop: any, onMove: any }\n  private active: any\n  private dragging: any\n  private mouse: any\n  private startPoint: any\n  private x: number | null\n  private y: number | null\n\n  constructor(canvas: Canvas, opts: any) {\n    this.canvas = canvas\n    this.opts = opts\n    this.x = 0\n    this.y = 0\n    this.initEvent()\n  }\n\n  private initEvent() {\n    this.canvas.el.addEventListener('mousedown', this.onMouseDown, false)\n    this.canvas.el.addEventListener('mouseup', this.onMouseUp, false)\n    // this.canvas.elem.addEventListener('mouseleave', this.onMouseUp, false)\n\n    document.documentElement.addEventListener('mousemove', this.onMouseMove, false)\n    document.documentElement.addEventListener('mouseup', this.onMouseUp, false)\n  }\n\n  private onMouseDown = (e: Event) => {\n    const { target } = e\n    const targetElem = target as HTMLElement\n    this.active = this.canvas.getNode(targetElem.id)\n\n    if (this.active && this.active.isDraggable) {\n      this.dragging = true\n\n      if (this.mouse && this.active) {\n        this.startPoint = {\n          x: this.mouse.x - this.active.x,\n          y: this.mouse.y - this.active.y\n        }\n      }\n      this.opts.onStart(targetElem.id)\n    }\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    let x = e.pageX - this.canvas.left\n    let y = e.pageY - this.canvas.top\n\n    x = x / this.canvas.scale\n    y = y / this.canvas.scale\n\n    this.mouse = { x, y }\n\n    if (this.dragging && this.active) {\n      x = x - this.startPoint.x\n      const xStr = String(Math.round(x))\n      const yStr = String(Math.round(y - this.startPoint.y))\n      x = parseInt(xStr, 10)\n      y = parseInt(yStr, 10)\n\n      const isout = isOut(x, y, this.canvas, this.active)\n      if (isout.x >= 0 || isout.y >= 0) {\n        x = isout.x\n        y = isout.y\n      }\n      this.opts.onMove(this.active.id, { x, y })\n      this.x = x\n      this.y = y\n    }\n  }\n\n  private onMouseUp = () => {\n    if (this.dragging && this.active) {\n\n      this.dragging = false\n\n      const { id } = this.active\n\n      if (id) {\n        if (typeof this.x !== 'undefined'\n          && typeof this.y !== 'undefined') {\n          this.opts.onStop(id, { x: this.x, y: this.y })\n        }\n\n        this.x = null\n        this.y = null\n        this.active = null\n      }\n    }\n  }\n}\n\nexport default Dragger\n","export default function isOut(x: number, y: number, container: any, node: any): { x: number, y: number } {\n  let newX = x \n  let newY = y\n  if (x <= 0) {\n    newX = 0\n  }\n\n  if (y <= 0) {\n    newY = 0\n  }\n\n  if (x + node.width >= container.width) {\n    newX = container.width - node.width\n  }\n\n  if (y + node.height >= container.height) {\n    newY = container.height - node.height\n  }\n\n  return {\n    x: newX >= 0 ? newX : -1,\n    y: newY >= 0 ? newY : -1\n  }\n}\n","import { isbool } from './utils'\n\nlet uid: number = 1\n\n/**\n *\n */\nclass Node {\n  private el: Element\n  private data: any\n  public id: string\n  public x: number\n  public y: number\n  public layout: {\n    rotate: number\n  } \n\n  public isDraggable: boolean\n  public islocked: boolean\n\n  constructor(data: any) {\n    this.el = document.createElement('div')\n\n    this.id = String(uid++)\n    this.el.id = this.id\n\n    this.el.classList.add('node')\n\n    this.isDraggable = isbool(data.draggable) ? data.draggable : true\n\n    this.islocked = false\n    this.data = { ...data }\n\n    this.x = this.data.x || 0\n    this.y = this.data.y || 0\n\n    this.layout = {\n      rotate: 0\n    }\n    this.initStyle()\n    this.render()\n  }\n\n  private initStyle() {\n    const el = this.el as HTMLElement\n    el.style.position = 'absolute'\n  }\n\n  /*\n  get x(): number {\n    return 0\n  }\n\n  get y(): number {\n    return 0\n  }\n  */\n\n  get width() {\n    return this.data.width\n  }\n\n  set width(val) {\n    this.data.width = val\n  }\n\n  get height() {\n    return this.data.height\n  }\n\n  set height(val: number) {\n    this.data.height = val\n  }\n\n  set rotate(deg: number) {\n    this.layout.rotate = deg\n    const el = this.el as HTMLElement\n    el.style.transform = `rotate(${deg}deg)`\n  }\n\n  get rotate() {\n    return this.layout.rotate\n  }\n\n  get scale() {\n    return this.data.scale || 1\n  }\n\n  set scale(val) {\n    this.data.scale = val\n    this.draw()\n  }\n\n  public lock() {\n    this.islocked = true\n    this.isDraggable = false\n  }\n\n  public unlock() {\n    this.islocked = false\n    this.isDraggable = true\n  }\n\n  public move(x: number, y: number) {\n    this.x = x\n    this.y = y\n    const el = this.el as HTMLElement\n    el.style.left = `${x}px`\n    el.style.top = `${y}px`\n  }\n\n  public render() {\n    const el = this.el as HTMLElement\n\n    el.style.left = `${this.x}px`\n    el.style.top = `${this.y}px`\n    el.style.width = `${ this.width * this.scale }px`\n    el.style.height = `${ this.height * this.scale }px`\n  }\n\n  public toJSON() {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      scale: this.scale\n    }\n  }\n}\n\nexport default Node\n","export function isbool(val: any): boolean {\n  return typeof val === 'boolean'\n}\n","import { query } from './utils/dom'\nimport Dragger from './dragger'\nimport Node from './node'\n\n/*\ninterface IOptions {\n  width?: number;\n  height?: number;\n}\n*/\n\nclass Konvas {\n  public el: Element\n  private options: any\n  private dragger: Dragger\n  public nodes: Node[]\n  public activeNode: Node\n  public layout: {\n    width: number,\n    height: number,\n    scale: number\n  } \n\n  constructor(el: Element | string, options = { width: 600, height: 300, scale: 1 } ) {\n    this.el = query(el)\n    this.options = options\n    this.nodes = []\n\n    this.layout = {\n      width: options.width,\n      height: options.height,\n      scale: options.scale || 1\n    }\n\n    /*\n    Object.defineProperty(this, 'scale', {\n      set(val: number) {\n        this.layout.scale = val\n      },\n      get(): any {\n        return this.layout.scale\n      }\n    }) */\n\n    this.dragger = new Dragger(this, {\n      onStart: (id: string) => {\n        const node = this.getNode(id)\n        if (node) {\n          this.activeNode = node\n        }\n        // this.resizeable.hide()\n      },\n      onMove: (id: string, { x, y }) => {\n        this.activeNode.move(x, y)\n      },\n      onStop: (id: string) => {\n        // console.log(id)\n        // this.emit('drag.end', id, { x, y })\n        // this.resizeable.move(x, y)\n      }\n    })\n    this.initStyle()\n  }\n\n  private initStyle() {\n    this.el.classList.add('konvas')\n    const elem = (this.el as HTMLElement)\n    elem.style.position = 'relative'\n    elem.style.transformOrigin = '0 0'\n\n    this.render()\n  }\n\n  public render() {\n    const elem = (this.el as HTMLElement)\n    const width = this.width * this.scale\n    const height = this.height * this.scale\n\n    elem.setAttribute('data-scale', String(this.scale))\n    elem.style.width = `${width}px`\n    elem.style.height = `${height}px`\n  }\n\n  public addNode(node: Node | any) {\n    if (node instanceof Node) {\n      this.nodes.push(node)\n    } else {\n      node = new Node(node)\n      this.el.appendChild(node.el)\n      this.nodes.push(node)\n    }\n  }\n\n  public getNode(node: Node | string): Node | null {\n    if (typeof node === 'string') {\n      const filters = this.nodes.filter((item: any) => item.id === node)\n      return filters[0]\n    }\n    return node\n  }\n\n  get left() {\n    return this.el.getBoundingClientRect().left\n  }\n\n  get top() {\n    return this.el.getBoundingClientRect().top\n  }\n\n  get scale() {\n    return this.layout.scale\n  }\n\n  set scale(val: number) {\n    this.layout.scale = val\n    this.render()\n  }\n\n  get width(): number {\n    return this.layout.width\n  }\n\n  get height(): number {\n    return this.layout.height\n  }\n\n  public toJSON() {\n    const nodes = this.nodes.map(node => {\n      return node.toJSON()\n    })\n\n    return {\n      width: this.width,\n      height: this.height,\n      scale: this.scale,\n      nodes\n    }\n  }\n}\n\nexport default Konvas\n","export function query(el: string | Element): Element {\n  if (typeof el === 'string') {\n    const node = document.querySelector(el)\n    if (!node) {\n      return document.createElement('div')\n    }\n    return node \n  } else {\n    return el\n  }\n}\n"],"names":["canvas","opts","this","e","targetElem","_this","active","getNode","id","isDraggable","dragging","mouse","startPoint","x","y","onStart","pageX","left","pageY","top","scale","xStr","String","Math","round","yStr","isout","container","node","newX","newY","width","height","isOut","parseInt","onMove","onStop","initEvent","Dragger","el","addEventListener","onMouseDown","onMouseUp","document","documentElement","onMouseMove","uid","data","createElement","classList","add","draggable","islocked","layout","rotate","initStyle","render","Node","style","position","Object","val","deg","transform","draw","options","querySelector","query","nodes","dragger","activeNode","_a","move","Konvas","elem","transformOrigin","setAttribute","push","appendChild","filter","item","getBoundingClientRect","map","toJSON"],"mappings":"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"}